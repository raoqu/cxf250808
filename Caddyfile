:8000 {
    # Enable file server for the current directory
    root * /Users/raoqu/mylab/___f
    file_server

    # Set appropriate Content Security Policy headers
    header {
        # Other security headers
        X-Content-Type-Options "nosniff"
        X-Frame-Options "SAMEORIGIN"
        Referrer-Policy "strict-origin-when-cross-origin"
        
        # Content Security Policy to allow scripts, styles, and API connections
        Content-Security-Policy "default-src 'none'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; connect-src 'self'; frame-src 'self'"

        # Enable CORS for local development
        Access-Control-Allow-Origin "*"
        Access-Control-Allow-Methods "GET, POST, OPTIONS"
        Access-Control-Allow-Headers "Origin, Content-Type, Accept"
    }

    handle /api/* {
        reverse_proxy 127.0.0.1:6161
    }

    # Custom error handling - show 404.html for not found errors
    handle_errors {
        rewrite * /404.html
        file_server
    }

    handle /Service/GetReport {
        rewrite * /lookup.html
    }
    handle /Service/* {
        uri strip_prefix /Service
        rewrite * {path}
    }
    handle /ReportFiles/* {
        uri strip_prefix /ReportFiles
        root * /Users/raoqu/mylab/___f/backend/upload
        file_server
    }

    # Log requests to console
    log {
        output stdout
        format console
    }
}
